<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="bootstrap.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Vehículo</title>
    <!-- Bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.css" />
    <!-- Custom styles for this template -->
    <link href="css/responsive.css" rel="stylesheet" />
</head>
<body>
    <!-- Header -->
    <header class="bg-light py-3 mb-4">
        <div class="container d-flex justify-content-between">
            <img src="images/logo2.jpg" alt="Logo del Taller" class="me-3" style="height: 70px;" /> <!-- Imagen del taller -->
            <h1 class="text-dark">Taller Innoauto</h1> <!-- Título del taller -->
            <div class="nav-btn-container mt-2">
                <button class="btn" onclick="window.location.href='pantIni.html'">Inicio</button>
                <button class="btn" onclick="window.location.href='listarPropietarios.html'">Propietarios</button>
                <button class="btn" onclick="window.location.href='listarRepuestos.html'">Inventario</button>
            </div>
        </div>
    </header>

    <div class="container mt-5">
        <h2 class="text-center text-dark">Registrar Vehículo</h2>
        <form id="vehicleForm" onsubmit="handleSubmit(event)">
            <div class="card mb-4">
                <div class="card-body">
                    <h4 class="card-title">Datos del Vehículo</h4>
                    <div class="form-group mb-3">
                        <label for="propietarioDni">*DNI del Propietario:</label>
                        <input type="text" class="form-control" id="propietarioDni" required>
                    </div>
                    <div class="form-group mb-3">
                        <label for="patente">*Patente:</label>
                        <input type="text" id="patente" name="patente" class="form-control" required pattern="^[A-Za-z0-9]{6}$" title="La patente debe tener exactamente 6 caracteres.">                    </div>
                    <div class="form-group mb-3">
                        <label for="marca">*Marca:</label>
                        <input type="text" class="form-control" id="marca" required autocomplete="off">
                    </div>
                    <div class="form-group mb-3">
                        <label for="modelo">*Modelo:</label>
                        <input type="text" class="form-control" id="modelo" required autocomplete="off">
                    </div>
                </div>
            </div>
            <button type="submit" class="btn btn-secondary">Registrar Vehículo</button>
        </form>
    </div>

    <!-- Footer -->
    <footer class="bg-light text-center py-3 mt-4">
        <div class="container">
            <p class="text-muted mb-0">© 2024 Taller Innoauto. Todos los derechos reservados.</p>
            <p class="text-muted">Contacto: info@innoauto.com | Teléfono: (123) 456-7890</p>
        </div>
    </footer>

    <script>
        // Rellenar el DNI del propietario desde la URL
        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const dni = urlParams.get('dni');
            if (dni) {
                document.getElementById('propietarioDni').value = dni; // Autocompletar el campo DNI
            }
        };

        async function handleSubmit(event) {
            event.preventDefault(); // Prevenir el envío por defecto del formulario

            const dni = document.getElementById("propietarioDni").value;
            const patente = document.getElementById("patente").value;
            const marca = document.getElementById("marca").value;
            const modelo = document.getElementById("modelo").value;

            const vehiculoData = {
                patente: patente,
                marca: marca,
                modelo: modelo
            };

            try {
                // Enviar la solicitud POST a la API
                const response = await fetch(`/api/vehiculos/propietario/${dni}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(vehiculoData)
                });

                if (response.ok) {
                    alert("Vehículo registrado exitosamente!");
                    window.location.href = 'crearOrden4.html'; // Redirigir a la página de creación de órdenes
                } else {
                    const errorData = await response.json();
                    alert("Error: " + (errorData.message || "Error al registrar el vehículo."));
                }
            } catch (error) {
                console.error('Error:', error);
                alert("Error de red al intentar registrar el vehículo.");
            }
        }
    </script>

</body>
</html>
