<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registrar Orden de Trabajo</title>
</head>
<body>

    <h1>Crear una nueva Orden de Trabajo</h1>
    <form id="orden-form">
        <!-- Datos del vehículo -->
        <h2>Datos del Vehículo</h2>
        <label for="patente">Patente:</label>
        <input type="text" id="patente" name="patente" maxlength="20" required /><br>

        <label for="marca">Marca:</label>
        <input type="text" id="marca" name="marca" maxlength="50" required /><br>

        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" maxlength="50" required /><br>

        <label for="detalleFalla">Detalle de la Falla:</label>
        <textarea id="detalleFalla" name="detalleFalla"></textarea><br>

        <label for="horasTrabajadas">Horas Trabajadas:</label>
        <input type="number" id="horasTrabajadas" name="horasTrabajadas" min="0" /><br>

        <label for="estado">Estado:</label>
        <select id="estado" name="estado" required>
            <option value="ACTIVO">Activo</option>
            <option value="FINALIZADO">Finalizado</option>
        </select><br>

        <label for="fechaIngreso">Fecha de Ingreso:</label>
        <input type="date" id="fechaIngreso" name="fechaIngreso" required /><br>

        <label for="empleadoAsignado">Empleado ID:</label>
        <input type="number" id="empleadoAsignado" name="empleadoAsignado" /><br>

        <!-- Datos del propietario -->
        <h2>Datos del Propietario</h2>
        <label for="propietarioDni">DNI del Propietario:</label>
        <input type="text" id="propietarioDni" name="propietarioDni" maxlength="20" required /><br>

        <label for="propietarioNombre">Nombre del Propietario:</label>
        <input type="text" id="propietarioNombre" name="propietarioNombre" maxlength="50" required /><br>

        <label for="propietarioApellido">Apellido del Propietario:</label>
        <input type="text" id="propietarioApellido" name="propietarioApellido" maxlength="50" required /><br>

        <label for="propietarioTelefono">Teléfono del Propietario:</label>
        <input type="tel" id="propietarioTelefono" name="propietarioTelefono" maxlength="15" required /><br>

        <label for="propietarioDireccion">Dirección del Propietario:</label>
        <input type="text" id="propietarioDireccion" name="propietarioDireccion" maxlength="100" required /><br>

        <button type="submit">Crear Orden</button>
    </form>

    <script>
        async function crearOrden(event) {
            event.preventDefault();

            // Datos del vehículo
            const patente = document.getElementById('patente').value;
            const marca = document.getElementById('marca').value;
            const modelo = document.getElementById('modelo').value;
            const detalleFalla = document.getElementById('detalleFalla').value;
            const horasTrabajadas = document.getElementById('horasTrabajadas').value;
            const estado = document.getElementById('estado').value;
            const fechaIngreso = document.getElementById('fechaIngreso').value;
            const empleadoAsignado = document.getElementById('empleadoAsignado').value;

            // Datos del propietario
            const propietarioDni = document.getElementById('propietarioDni').value;
            const propietarioNombre = document.getElementById('propietarioNombre').value;
            const propietarioApellido = document.getElementById('propietarioApellido').value;
            const propietarioTelefono = document.getElementById('propietarioTelefono').value;
            const propietarioDireccion = document.getElementById('propietarioDireccion').value;

            const nuevaOrden = {
                patente: patente,
                marca: marca,
                modelo: modelo,
                detalleFalla: detalleFalla,
                horasTrabajadas: horasTrabajadas ? parseInt(horasTrabajadas) : null,
                estado: estado,
                fechaIngreso: fechaIngreso,
                empleadoAsignado: empleadoAsignado ? parseInt(empleadoAsignado) : null,
                propietario: {
                    dni: propietarioDni,
                    nombre: propietarioNombre,
                    apellido: propietarioApellido,
                    telefono: propietarioTelefono,
                    direccion: propietarioDireccion
                }
            };

            try {
                const response = await fetch('http://localhost:8080/api/ordenes', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(nuevaOrden)
                });

                if (!response.ok) {
                    const errorMessage = await response.text();
                    throw new Error('Error al crear la orden: ' + response.status + ' - ' + errorMessage);
                }

                alert('Orden creada exitosamente!');
                document.getElementById('orden-form').reset();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        document.getElementById('orden-form').addEventListener('submit', crearOrden);
    </script>

</body>
</html>
